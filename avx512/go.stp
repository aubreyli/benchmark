#!/usr/local/bin/stap

global init_time
global cn
global curr_cpu
global proc_name

probe begin{
        printf("Press ^C to stop\n")
        init_time = gettimeofday_ms()
        cn = 0
}

probe scheduler.ctxswitch
{
	if (cpu() == 52) {
		printf("%s\t\t%s\n", prev_task_name, next_task_name)
#		if (next_task_name == "schbench")
#			print_backtrace()
	}
}

# Switch done
probe kernel.trace("sched:sched_debug")
{
	if (cpu() == 52 && $flag == 55555) {
		printf("cpu=%d, cpumask =%d, value =%d flag = %d\n", $cpu, $cpumask, $interval, $flag)
	}
}

probe timer.s(100)
{
        cn++
        if (cn > 0)
                exit()
}

probe end {
        printf("Total time: %d miliseconds\n", gettimeofday_ms() - init_time)
}
